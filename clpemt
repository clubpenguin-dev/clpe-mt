#!/bin/bash

# Detect package manager
detect_package_manager() {
    if command -v apt &> /dev/null; then
        PM="apt"
    elif command -v dnf &> /dev/null; then
        PM="dnf"
    elif command -v pacman &> /dev/null; then
        PM="pacman"
    else
        echo "Unsupported package manager. Supported: apt, dnf, pacman."
        exit 1
    fi
}

# Display Title
display_title() {
    clear
    echo "====================="
    echo "   CLPE Multitool    "
    echo "====================="
}

# System Monitoring
system_monitoring() {
    display_title
    case $1 in
        1) neofetch ;;
        2) df -h ;;
        3) free -h ;;
        4) top -bn1 | grep "Cpu(s)" ;;
        5) sensors ;;
        *) echo "Invalid option" ;;
    esac
}

# Network Tools
network_tools() {
    display_title
    case $1 in
        1) ip a ;;
        2) read -p "Host to ping: " h; ping -c 4 $h ;;
        3) speedtest-cli ;;
        4) ss -tuln ;;
        *) echo "Invalid option" ;;
    esac
}

# File Management
file_management() {
    display_title
    case $1 in
        1) read -p "Directory to backup: " d; read -p "Destination: " dst; tar -czvf $dst $d ;;
        2) read -p "Backup file: " f; read -p "Restore to: " r; tar -xzvf $f -C $r ;;
        3) read -p "File to compress: " f; read -p "Destination (file.tar.gz): " dst; tar -czvf $dst $f ;;
        4) read -p "Compressed file: " f; read -p "Extract to: " d; tar -xzvf $f -C $d ;;
        5) read -p "Directory: " d; find $d -type f -exec du -h {} + | sort -rh | head -n 10 ;;
        *) echo "Invalid option" ;;
    esac
}

# System Management (based on package manager)
system_management() {
    display_title
    case $1 in
        1) 
            case $PM in
                apt) sudo apt update && sudo apt upgrade -y ;;
                dnf) sudo dnf update -y ;;
                pacman) sudo pacman -Syu ;;
            esac
            ;;
        2) 
            case $PM in
                apt) sudo apt clean ;;
                dnf) sudo dnf clean all ;;
                pacman) sudo pacman -Scc ;;
            esac
            ;;
        3) 
            case $PM in
                apt) sudo apt autoremove ;;
                dnf) sudo dnf autoremove ;;
                pacman) sudo pacman -Rns $(pacman -Qdtq) ;;
            esac
            ;;
        *) echo "Invalid option" ;;
    esac
}

# Security Tools
security_tools() {
    display_title
    case $1 in
        1) sudo firewall-cmd --state ;;
        2) sudo firewall-cmd --add-service=ssh --permanent; sudo firewall-cmd --reload ;;
        3) sudo firewall-cmd --remove-service=ssh --permanent; sudo firewall-cmd --reload ;;
        *) echo "Invalid option" ;;
    esac
}

# Main Menu
main_menu() {
    display_title
    echo -e "Categories:\n1) System Monitoring\n2) Network Tools\n3) File Management\n4) System Management\n5) Security Tools"
    read -p "Choose a category: " cat
    case $cat in
        1) echo -e "1) System Info\n2) Disk Usage\n3) Memory Usage\n4) CPU Usage\n5) Check Temperature"; read -p "Choose tool: " tool; system_monitoring $tool ;;
        2) echo -e "1) Network Info\n2) Ping\n3) Speed Test\n4) Open Ports"; read -p "Choose tool: " tool; network_tools $tool ;;
        3) echo -e "1) Backup\n2) Restore\n3) Compress\n4) Decompress\n5) Find Large Files"; read -p "Choose tool: " tool; file_management $tool ;;
        4) echo -e "1) System Update\n2) Clear Cache\n3) Remove Old Kernels"; read -p "Choose tool: " tool; system_management $tool ;;
        5) echo -e "1) Firewall Status\n2) Enable SSH\n3) Disable SSH"; read -p "Choose tool: " tool; security_tools $tool ;;
        *) echo "Invalid category" ;;
    esac
}

# Run
detect_package_manager
main_menu
